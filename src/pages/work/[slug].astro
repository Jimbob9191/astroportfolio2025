---
import CaseStudyLayout from '../../layouts/CaseStudyLayout.astro';
import { caseStudies } from '../../data/caseStudies';

export function getStaticPaths() {
  return caseStudies.map(project => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { title, slug } = project;

const galleryImages = [
  {
    thumbnail: 'https://images.pexels.com/photos/6802042/pexels-photo-6802042.jpeg?auto=compress&cs=tinysrgb&w=600',
    large: 'https://images.pexels.com/photos/6802042/pexels-photo-6802042.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
    width: 1260,
    height: 750,
    alt: 'Finance app dashboard design'
  },
  {
    thumbnail: 'https://images.pexels.com/photos/6802049/pexels-photo-6802049.jpeg?auto=compress&cs=tinysrgb&w=600',
    large: 'https://images.pexels.com/photos/6802049/pexels-photo-6802049.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
    width: 1260,
    height: 750,
    alt: 'Finance app mobile screens'
  }
];

const additionalGalleryImages = [
  {
    thumbnail: 'https://images.pexels.com/photos/6802051/pexels-photo-6802051.jpeg?auto=compress&cs=tinysrgb&w=600',
    large: 'https://images.pexels.com/photos/6802051/pexels-photo-6802051.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
    width: 1260,
    height: 750,
    alt: 'Finance app user flow'
  },
  {
    thumbnail: 'https://images.pexels.com/photos/6802062/pexels-photo-6802062.jpeg?auto=compress&cs=tinysrgb&w=600',
    large: 'https://images.pexels.com/photos/6802062/pexels-photo-6802062.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
    width: 1260,
    height: 750,
    alt: 'Finance app wireframes'
  },
  {
    thumbnail: 'https://images.pexels.com/photos/6802069/pexels-photo-6802069.jpeg?auto=compress&cs=tinysrgb&w=600',
    large: 'https://images.pexels.com/photos/6802069/pexels-photo-6802069.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
    width: 1260,
    height: 750,
    alt: 'Finance app components'
  },
  {
    thumbnail: 'https://images.pexels.com/photos/6802073/pexels-photo-6802073.jpeg?auto=compress&cs=tinysrgb&w=600',
    large: 'https://images.pexels.com/photos/6802073/pexels-photo-6802073.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
    width: 1260,
    height: 750,
    alt: 'Finance app style guide'
  }
];

const finalImage = {
  thumbnail: 'https://images.pexels.com/photos/6802080/pexels-photo-6802080.jpeg?auto=compress&cs=tinysrgb&w=600',
  large: 'https://images.pexels.com/photos/6802080/pexels-photo-6802080.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
  width: 1260,
  height: 750,
  alt: 'Finance app final presentation'
};
---

<CaseStudyLayout title={title} slug={slug}>
  <section class="mb-20">
    <h2 class="text-2xl md:text-3xl font-display font-medium mb-8">Gallery</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="gallery1">
      {galleryImages.map((image) => (
        <a 
          href={image.large}
          class="block img-hover rounded-lg overflow-hidden gallery-item"
          data-pswp-width={image.width}
          data-pswp-height={image.height}
        >
          <img 
            src={image.thumbnail} 
            alt={image.alt}
            class="w-full h-full object-cover"
            loading="lazy"
          />
        </a>
      ))}
    </div>
  </section>

  <section class="mb-20">
    <h2 class="text-2xl md:text-3xl font-display font-medium mb-8">Design Process</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="gallery2">
      {additionalGalleryImages.map((image) => (
        <a 
          href={image.large}
          class="block img-hover rounded-lg overflow-hidden gallery-item"
          data-pswp-width={image.width}
          data-pswp-height={image.height}
        >
          <img 
            src={image.thumbnail} 
            alt={image.alt}
            class="w-full h-full object-cover"
            loading="lazy"
          />
        </a>
      ))}
    </div>
  </section>

  <section class="mb-20">
    <h2 class="text-2xl md:text-3xl font-display font-medium mb-8">Final Presentation</h2>
    <div id="gallery3">
      <a 
        href={finalImage.large}
        class="block img-hover rounded-lg overflow-hidden gallery-item"
        data-pswp-width={finalImage.width}
        data-pswp-height={finalImage.height}
      >
        <img 
          src={finalImage.thumbnail} 
          alt={finalImage.alt}
          class="w-full h-full object-cover"
          loading="lazy"
        />
      </a>
    </div>
  </section>
</CaseStudyLayout>

<script>
  import PhotoSwipe from 'photoswipe';
  import 'photoswipe/dist/photoswipe.css';

  const initPhotoSwipe = (galleryId: string) => {
    const gallery = document.querySelector(`#${galleryId}`);
    
    if (!gallery) return;
    
    const galleryItems = gallery.querySelectorAll('.gallery-item');
    
    galleryItems.forEach((item, index) => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        
        const options = {
          gallery,
          dataSource: Array.from(galleryItems).map(galleryItem => ({
            src: galleryItem.href,
            width: parseInt(galleryItem.getAttribute('data-pswp-width')),
            height: parseInt(galleryItem.getAttribute('data-pswp-height')),
            msrc: galleryItem.querySelector('img').src
          })),
          index,
          showHideAnimationType: 'fade',
          showAnimationDuration: 300,
          hideAnimationDuration: 300,
          bgOpacity: 0.8,
          spacing: 0.1,
          allowPanToNext: true,
          maxSpreadZoom: 2,
          getDoubleTapZoom: (isMouseClick, item) => isMouseClick ? 2 : 1,
          pinchToClose: true,
          closeOnScroll: false,
          closeOnVerticalDrag: true,
          wheelToZoom: true,
          padding: { top: 20, bottom: 20, left: 20, right: 20 },
          fit: 'contain',
          pswpModule: () => import('photoswipe')
        };
        
        const lightbox = new PhotoSwipe(options);
        lightbox.init();
      });
    });
  };

  document.addEventListener('DOMContentLoaded', () => {
    initPhotoSwipe('gallery1');
    initPhotoSwipe('gallery2');
    initPhotoSwipe('gallery3');
  });
</script>