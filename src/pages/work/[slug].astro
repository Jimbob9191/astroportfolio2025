---
import CaseStudyLayout from '../../layouts/CaseStudyLayout.astro';
import { caseStudies } from '../../data/caseStudies';

export function getStaticPaths() {
  return caseStudies.map(project => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { title, slug } = project;

const galleryImages = [
  {
    thumbnail: 'https://images.pexels.com/photos/6802042/pexels-photo-6802042.jpeg?auto=compress&cs=tinysrgb&w=600',
    large: 'https://images.pexels.com/photos/6802042/pexels-photo-6802042.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
    width: 1260,
    height: 750,
    alt: 'Finance app dashboard design'
  },
  {
    thumbnail: 'https://images.pexels.com/photos/6802049/pexels-photo-6802049.jpeg?auto=compress&cs=tinysrgb&w=600',
    large: 'https://images.pexels.com/photos/6802049/pexels-photo-6802049.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
    width: 1260,
    height: 750,
    alt: 'Finance app mobile screens'
  }
];
---

<CaseStudyLayout title={title} slug={slug}>
  <section class="mb-20">
    <h2 class="text-2xl md:text-3xl font-display font-medium mb-8">Gallery</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="gallery">
      {galleryImages.map((image) => (
        <a 
          href={image.large}
          class="block img-hover rounded-lg overflow-hidden gallery-item"
          data-pswp-width={image.width}
          data-pswp-height={image.height}
          data-pswp-src={image.large}
        >
          <img 
            src={image.thumbnail} 
            alt={image.alt}
            class="w-full h-full object-cover"
            loading="lazy"
          />
        </a>
      ))}
    </div>
  </section>
</CaseStudyLayout>

<script>
  import PhotoSwipe from 'photoswipe';
  import 'photoswipe/dist/photoswipe.css';

  const initPhotoSwipe = () => {
    const gallery = document.querySelector('#gallery');
    
    if (!gallery) return;
    
    const galleryItems = document.querySelectorAll('.gallery-item');
    
    galleryItems.forEach((item, index) => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        
        const options = {
          gallery,
          dataSource: Array.from(galleryItems).map(item => ({
            src: item.getAttribute('data-pswp-src'),
            width: parseInt(item.getAttribute('data-pswp-width')),
            height: parseInt(item.getAttribute('data-pswp-height')),
          })),
          index,
          pswpModule: () => import('photoswipe')
        };
        
        const lightbox = new PhotoSwipe(options);
        lightbox.init();
      });
    });
  };

  document.addEventListener('DOMContentLoaded', initPhotoSwipe);
</script>